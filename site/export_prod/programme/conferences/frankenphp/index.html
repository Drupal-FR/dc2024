<!doctype html>
<html lang="en">
  <head>

  <title>Avec FrankenPHP, PHP revient d&#39;entre les morts | Drupalcamp Rennes 2024</title>

  <link href="/css/main.css" rel="stylesheet">

	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <base href="https://rennes2024.drupalcamp.fr/">

	
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  
  <meta property="og:title" content="Avec FrankenPHP, PHP revient d&#39;entre les morts" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rennes2024.drupalcamp.fr/programme/conferences/frankenphp/" /><meta property="og:image" content="https://rennes2024.drupalcamp.fr/img/og-image.jpg"/><meta property="article:section" content="programme" />





</head>

  <body>
    <div class="content-container">
      
<nav aria-label="Menu principal" class="menu" xmlns="http://www.w3.org/1999/html">
  <a href="/" class="menu__logo" title="Page d'accueil">
    <img src="/img/logo_hermine.svg" alt="Une hermine baptisée Yuna, symbole de la Bretagne et mascotte du Drupalcamp." />
  </a>
  <div class="menu__site-promoted">
    <p class="menu__site-name">
      <button data-js-selector="navigation" aria-controls="nav-main" aria-label="Afficher la navigation"></button> <a href="/"><img src="/img/dcrennes_title_text.svg" alt="Drupalcamp Roazhon" class="site-title"/><br />
        <img src="/img/dcrennes_subtitle_text.svg" alt="Rennes, 28-30 mars 2024"  class="site-subtitle" />
      </a>
    </p>
    <p class="menu__tickets-push" data-js-selector="nav-tickets">
      <a href="/billetterie" title="Accéder à la billetterie et infos des tarifs">Billetterie</a>
    </p>
  </div>
  <ul class="menu__items" id="nav-main">

    
    

    
    
    
      
        
      
    
      
        
      
    
    <li class=" menu__item menu__item--submenu">
      <a href="/actualites/">Actualités</a>
        <ul class="menu__items menu__items--submenu">

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/presse/">Presse</a>
    </li>
        </ul>
    </li>

    
    

    
    
    
      
        
      
    
      
        
      
    
    <li class=" menu__item menu__item--submenu">
      <a aria-current="true" class="ancestor" href="/programme/">Programme</a>
        <ul class="menu__items menu__items--submenu">

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/programme/appel/">Appel à conférences</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/programme/accompagnement/">Accompagnement</a>
    </li>
        </ul>
    </li>

    
    

    
    
    
      
        
      
    
      
        
      
    
    <li class=" menu__item menu__item--submenu">
      <a href="/sponsors/">Sponsors</a>
        <ul class="menu__items menu__items--submenu">

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/sponsors/grille/">Les formules</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/sponsors/contact-sponsors/">Devenir sponsor</a>
    </li>
        </ul>
    </li>

    
    

    
    
    
      
        
      
    
      
        
      
    
    <li class=" menu__item menu__item--submenu">
      <a href="/communaute/">Communauté</a>
        <ul class="menu__items menu__items--submenu">

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/drupal/">Drupal, qu'est ce que c'est ?</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/adff/">L'association</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/b%C3%A9n%C3%A9voles/">Bénévoles</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/charte/">Charte de bonne conduite</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/tombola-concours/">Tombola & Concours</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/communaute/entreprise/">Convaincre mon entreprise</a>
    </li>
        </ul>
    </li>

    
    

    
    
    
      
        
      
    
      
        
      
    
    <li class=" menu__item menu__item--submenu">
      <a href="/infos/">Infos pratiques</a>
        <ul class="menu__items menu__items--submenu">

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/contact/">Contact</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/infos/acc%C3%A8s/">Accéder au Drupalcamp</a>
    </li>

    

    
    
    
      
        
      
    
    <li class=" menu__item">
      <a href="/infos/venir-dormir/">Venir, Sortir & Dormir</a>
    </li>
        </ul>
    </li>
  </ul>
</nav>


      





<main class="main-content">
  <div class="conference-full session-level--pleniere">
    <header class="conference-full__header">
      <h1 class="conference-full__title"><span class="session-level">Plénière</span> Avec FrankenPHP, PHP revient d&#39;entre les morts</h1>

      <ul class="conference-full__meta">
        <li class="conference-full__speakers conference-full__meta-item"><svg class="icon icon--session">
  <title></title>
  <use xlink:href="/icons/icons-sessions.svg#sprite-icons-speaker" />
</svg>
Kévin Dunglas - Les Tilleuls</li>
        <li class="conference-full__duration conference-full__meta-item"><svg class="icon icon--session">
  <title></title>
  <use xlink:href="/icons/icons-sessions.svg#sprite-icons-timer" />
</svg>
40 min </li>
        <li class="conference-full__themes conference-full__meta-item"><svg class="icon icon--session">
  <title></title>
  <use xlink:href="/icons/icons-sessions.svg#sprite-icons-tags" />
</svg>
Analyse </li>
      </ul>
    </header>
    <div class="conference-full__teaser"><p>FrankenPHP est un serveur d&rsquo;application qui donne des super-pouvoirs à vos applications PHP : déploiements simplifiés, applications distribuables sous forme d&rsquo;un seul fichier exécutable, HTTPS automatique, support de HTTP/2 et HTTP/3, préchargement des assets avec les Early Hints, mode worker mode, capacités temps réel&hellip;</p>
<p>Découvrons comment faire basculer vos apps dans le monde moderne !</p>
 </div>
    <div class="conference-full__details">
      <div class="conference-full__description">
        
        
        
      </div>
      
      
      <div class="conference-full__slides"><h3>Support de la présentation :</h3>
        <a href="/programme/conferences/slides/frankenphp-drupal-sliides-visibles.pdf">Télécharger le support utilisé pendant la conférence.</a>
      </div>
      
      
      <div class="conference-full__video">
        <h3>Captation de la conférence</h3>
        <iframe src="https://www.youtube-nocookie.com/embed/DXWGHF95Rbs"
                title="YouTube video player" frameborder="0"
                allowfullscreen></iframe>
        
        <div class="conference-full__video_transcript">
        <h3>Transcription</h3>
         <p>- Kévin Dunglas: merci à tous. Merci de me recevoir. Je ne vais pas vous faire faire de sport. Je vais vous présenter le projet FrankenPHP, que j’ai essayé d’adapter avec Drupal, mais je ne m’y connais pas du tout, donc dites-moi si je dis des bêtises.</p>
<p>Je contribue beaucoup à l’écosystème Go, ce qui m’a amené à travailler sur ce projet.</p>
<p>Je travaille aussi dans une boîte très engagée. Chez nous, il n’y a pas que des anarchistes, on a même des gens de la France insoumise, c’est dire combien on est ouverts. C’est une boîte qui appartient à 100% à ses salariés, les décisions sont prises démocratiquement, on répartit les bénéfices à parts égales en fin d’année.</p>
<p>On est présent au Maghreb aussi. On a des bureaux à Rennes, mais mes collègues ne font pas de Drupal, donc ils ne sont pas venus. Désolé.</p>
<p>On fait principalement du PHP tout framework et CMS confondus, du Go et du Javascript. Parfois, c’est obligatoire.</p>
<p>Venons-en au projet. Qu’est-ce que FrankenPHP ? </p>
<p>Qui parmi vous voit ce que c’est Nginx ?  Tout le monde.</p>
<p>Qui utilise Nginx+FPM ?  Qui utilise autre chose ? </p>
<p>Qui utilise quelque chose qui n’est ni Apaches ni PHP FPM ? </p>
<p>- (…) (intervention inaudible)</p>
<p>- Le serveur de développement ? </p>
<p>Effectivement, il y a aussi possibilité d’utiliser le serveur de développement PHP moins S, mais uniquement en local. Ça ne peut servir qu’une requête en parallèle, ça ne fait pas beaucoup. En production, vous risquez d’avoir des sites très lents si vous utilisez ça.</p>
<p>FrankenPHP remplace le serveur web et le moteur d’exécution PHP.</p>
<p>Quand on a commencé à bosser là-dessus, on avait un objectif principal :  simplifier nos déploiements en production et en particulier dans des environnements containerisés. On a des équipes hébergement Devops . Et déployer du PHP, ce n’est plus juste copier des fichiers, la plupart du temps, on demande d’utiliser des plateformes de cloud. Ça peut poser pas mal de difficultés. Il faut 2 containers qui vont communiquer ensemble. En général, il faut un volume partagé entre les 2 containers. Un truc simple à la base est finalement devenu compliqué.</p>
<p>L’objectif était de simplifier ces déploiements.</p>
<p>On a vu qu’on pouvait faire mieux que ça. Quand on n’utilise pas Docker. Simplifier les déploiements, aussi en termes de distribution    d’applications. Cet outil est écrit dans un mélange de Go et de C. Et en PHP évidemment pour faire tourner tout ça. Ce qui permet d’ajouter des fonctionnalités qui tirent parti de la plateforme web, et qui ne sont pas forcément évidentes à faire en PHP traditionnel. Alors que ce sont des trucs de plus en plus populaires dans les autres écosystèmes.</p>
<p>Petite spécificité par rapport aux outils similaire :  c’est compatible avec tous les projets PHP existants. C’est possible d’utiliser ce nouveau moteur d’exécution quel que soit votre projet, même si c’est des projets anciens. Il y a quelques outils qui ressemblent par certains aspects, en particulier Soul, fait par des contributeurs chinois, et Road Runner, fait par une boîte américaine.</p>
<p>L’un des objectifs de FrankenPHP, c’est d’être utilisé sur les applis sans modification.</p>
<p>Premier enjeu :  rendre ça le plus simple possible à utiliser. Pour installer PHP sur un ordinateur de production, il faut un PHP FPM, un serveur qui va bien etc. Là, on a créé un seul binaire. Ça va fonctionner de manière totalement autonome sur le serveur.</p>
<p>Il y a tout ce qu’il faut pour déployer un projet en production, pour lancer nos tests fonctionnels de bout en bout.</p>
<p>On n’a pas réinventé la roue. On s’est appuyé sur un serveur web modulaire Caddy. Qui l’a déjà utilisé ?  Pas mal de monde.</p>
<p>Pour ceux qui ne connaissent pas, même si vous ne faites pas de PHP, c’est un nouveau serveur web entièrement libre, qui est écrit en Go, qui s’appuie beaucoup sur la bibliothèque standard de Go, avec pas mal de fonctionnalités, fait pour les environnements Cloud. C’est-à-dire que de base, on va avoir une API qui va changer à chaud la configuration du serveur web. Caddy va pouvoir gérer nativement le renouvellement de certificats entre autres.</p>
<p>Automatiquement, l’outil va générer des certificats valides.</p>
<p>Finalement, Caddy propose le support de toutes les fonctionnalités les plus avancées du protocole web, en particulier http 2 et 3.</p>
<p>Il y a aussi le support des Early Ins* pour accélérer le temps de chargement des pages web. Caddy est écrit en Go.</p>
<p>FrankenPHP est un module pour Caddy, qui est écrit en Go et en C, qui va charger l’exécuteur.</p>
<p>Ça ressemble à ce qui se faisait avec mode PHP côté Apache. Sauf que mode PHP est déprécié chez Apache. Il y avait un vide à combler, qu’on a essayé de faire aussi.</p>
<p>Au coeur de l’outil, il y a une bibliothèque en Go, qui permet d’exécuter du code ou des scripts PHP depuis un programme écrit en Go, et de récupérer le résultat de tout ça, et aussi d’intégrer les scripts PHP, de les servir via le serveur web natif. C’est un bibliothèque qui est du logiciel libre, utilisable avec n’importe quel programme en Go. En Go, vous pouvez créer un petit serveur http, et si vous utilisez cette bibliothèque, vous pouvez utiliser le support PHP très facilement.</p>
<p>On a joué avec ça ?  Qui a déjà utilisé Symfony sans Drupal ?  Tout le monde.</p>
<p>On a un patch disponible sur GitHub pour exécuter les scripts en développement, et ça n’utilise pas Caddy. Ce serait facile d’intégrer FrankenPHP aussi, ça pourrait fonctionner, mais on n’a pas pris le temps de le faire. Ça permet d’embarquer PHP dans n’importe quel programme Go.</p>
<p>PHP propose depuis toujours une couche d’abstraction.</p>
<p>Il y a d’autres Sapi moins connus. Il y en a un pour lancer PHP.</p>
<p>En plus de ça, on a écrit un module pour le serveur web Caddy.</p>
<p>Quand on parle de FrankenPHP, on parle du serveur complet fini qu’on installe sur sa machine. Mais il y a aussi une bibliothèque Go utilisable dans n’importe quel projet.</p>
<p>Ça, ça a permis d’ajouter le support de PHP nativement sans dépendance externe à Caddy.</p>
<p>Ensuite, on a pu écrire du code spécifique à FrankenPHP qui a permis d’ajouter des fonctionnalités uniques à l’outil qui sont utilisables seulement quand on utilise FrankenPHP.</p>
<p>Qu’est-ce que ça fait par défaut ? </p>
<p>Le support natif de https, et de http/3, 1 et 2, le support de la compression y compris Brotli et Zstandard.</p>
<p>Des fonctionnalités qui sont modernes et pratiques dans des infrastructures cloud :  le support natif des logs structurés. Les logs vont être en Jason. Ils seront facilement ingérés. C’est entièrement paramétrable, on peut choisir ce qu’on logge, et où on le logge.</p>
<p>Il y a aussi le support natif du tracing et des metrics avec Prometheus . Il y en a fournis par Caddy. FrankenPHP en ajoute quelques-unes spécifiques à PHP.</p>
<p>Pour les sites à fort trafic, il y a aussi les outils qui permettent de faire du rechargement sans couper les connexions en cours.</p>
<p>Si on résume, on a un outil qui est compatible avec à peu près toutes les applications PHP. On l’a testé avec succès, avec Drupal, Laravel, Symfony.</p>
<p>Pour utiliser l’outil, on peut télécharger un binaire sur sa machine et le lancer en développement ou en production. Il y a aussi des images Docker officielles qui étendent les images, qui sont fournies qui permettent d’utiliser facilement l’outil.</p>
<p>On peut configurer très fortement l’outil, le serveur web Caddy est configurable via un fichier spécifique, le Caddyfile.</p>
<p>Vu que ça utilise derrière le vrai moteur PHP, on peut utiliser php.ini. C’est libre et gratuit.</p>
<p>Comment on utilise ça ? </p>
<p>Il y a la communauté Drupal qui a créé un squelette qui fonctionne de la même manière, qui étend les images Drupal officielles. Sauf qu’au lieu d’utiliser Apache, ça va utiliser FrankenPHP.</p>
<p>Vous pouvez aller sur ce dépôt GitHub et lancer ces commandes.</p>
<p>Ça devrait être fonctionnel. Vous aurez toutes les fonctionnalités automatiquement.</p>
<p>On va dans le dépôt. Vous pouvez regarder dans le Docker file comment c’est fait.</p>
<p>Pour les applications qui ne sont pas Drupal, là, c’est un exemple avec Laravel, on peut télécharger le binaire depuis le site, lancer la commande. On peut changer via l’option Root, le dossier qui comporte les fichiers publics. C’est ce que fait là cette commande. En général, ça suffit pour avoir une installation de PHP de qualité production sur n’importe quelle machine.</p>
<p>Si vous avez installé PHP sans Docker à la main, c’est plus chiant que ça.</p>
<p>En travaillant sur le projet, on s’est rendu compte qu’on avait aussi l’opportunité d’ajouter un mode plus particulier qui permet d’améliorer fortement les performances des applications PHP.</p>
<p>Ce qu’on appelle le mode work, qui est optionnel. Il va par contre permettre, si vos applis sont codées correctement, d’améliorer fortement les performances de vos applications    PHP.</p>
<p>L’idée, c’est de copier le mode de fonctionnement des serveurs des autres langages, ça va être de booter notre application    PHP, la garder en mémoire, et réaliser cette application pour traiter les requêtes qui arrivent. L’une des forces historiques de PHP, c’est que c’est un langage fire and forget. Quand votre serveur http reçoit une requête, il va demander à PHP d’aller exécuter un fichier, du coup, PHP va exécuter votre script PHP, votre Drupal, lire la requête, créer plein de services pour lire cette requête, vous permettre de générer une réponse http. Vous l’envoyez au navigateur, et on fait table rase de tout ce qui a été créé. Et pour la requête d’après, on recommence.</p>
<p>Des applications web qu’on écrit en Java, en Go, en général, ça fonctionne différemment car on écrit un programme qui va écouter un serveur, et on va pouvoir initialiser tout un tas de codes, qu’on va partager. On va pouvoir utiliser ces services pour traiter plusieurs requêtes. L’avantage, c’est que ça permet d’optimiser beaucoup les performances.</p>
<p>Drupal, Laravel, ils ont un kernel, ils vont devoir instancier beaucoup d’objets. Ça va prendre un peu de temps.</p>
<p>Un outil comme Black Fire, si votre code est un peu optimisé, vous arrivez rapidement à un temps incompressible de lancement d’application qui est gros. Ça, il faut le faire pour chaque requête. Ce n’est pas le cas dans les langages où il y a du contexte qui persiste entre chaque requête.</p>
<p>Il y a un gros avantage, c’est que si vous gérez mal votre mémoire, si vous avez du code un peu moyen qui crée des variables globales pourries, ce n’est pas très grave, car après chaque requête, on met le contexte à zéro.</p>
<p>Faire plus attention va permettre de gagner beaucoup en performance.</p>
<p>Je résume :  le serveur web, quand il va démarrer, on peut lui indiquer un script PHP. Pour l’instant, ce script est indépendant des requêtes qui vont arriver.</p>
<p>Ensuite, quand il va recevoir une requête, il va pouvoir exécuter du code PHP. Par contre, il va pouvoir réutiliser des objets qu’il aura créés au démarrage.</p>
<p>Ça va permettre de gagner du temps. Cela demande de gérer le parallélisme de manière tricky etc. Mais dans le langage de programmation, on a des primitifs optimisés, efficaces, ce sont les goroutines et les channels. C’est une possibilité de lancer du code de manière parallèle et très performante.</p>
<p>Du coup, on peut utiliser toute la force de C et de Go. C’est possible en C, mais ce n’est pas évident. Le faire de façon aussi optimisée que dans Go, c’est pratiquement impossible.</p>
<p>On l’a fait en Go.</p>
<p>Derrière ce mode worker, il y a pas mal de code complexe qui va permettre de faire en sorte que le dispatch, ça va être fait en Go.</p>
<p>Ça ressemble à un autre outil qui est aussi écrit en Go, RoadRunner. C’est un peu comme PHP FPM, c’est un service dédié, il faut un serveur web à côté, il faut des échanges réseau. C’est comme si on avait un worker, qui était un autre serveur à côté.</p>
<p>FrankenPHP, c’est un seul process, c’est juste techniquement un appel de fonctions, style C. On peut mélanger du Go, du C assez facilement, et il n’y a pas d’appel réseau, c’est un appel de fonctions. Le serveur web appelle une fonction qui permet au serveur web de traiter la requête.</p>
<p>C’est beaucoup plus rapide que RoadRunner, qui lui-même est plus rapide que PHP FPM.</p>
<p>RoadRunner, ils ont fait une API spécifique.</p>
<p>Dans FrankenPHP, on a fait plus simple, on utilise juste les Superglobals traditionnels.</p>
<p>Dernière grosse différence, c’est que ce mode est entièrement optionnel.</p>
<p>Dans Symfony, depuis quelque temps, il y a un composant qui permet de booter l’application sur différents environnements. C’est le composant RunTime. Vous l’avez déjà utilisé ? </p>
<p>Si vous avez fait du Symfony sans Drupal, vous l’avez forcément utilisé.</p>
<p>Ce composant est pratique, il permet d’abstraire comment on va démarrer une application.</p>
<p>On va pouvoir fournir une autre implémentation du runtime et avoir le support automatique du FrankenPHP.</p>
<p>Pour Drupal, je sais qu’il y avait des tickets ouverts. Il me semble qu’il y a des ateliers contribution aujourd’hui et demain. On en rediscutera un peu. Si vous voulez bosser avec moi pour améliorer le support, ce sera avec plaisir.</p>
<p>En Symfony, sur n’importe quel projet, il n’y a qu’à installer le système de gestion des workers. Tout ça est disponible dans PHP Runtime. On démarre FrankenPHP en lui indiquant avec l’option W le script worker à utiliser.</p>
<p>C’est le même qu’on aurait avec Apache.</p>
<p>Ça marche.</p>
<p>On a le traitement. Symfony est démarré une fois. Il va être démarré deux fois le nombre de CPU de votre machine. Il n’y a pas un seul script worker qui démarre.</p>
<p>Ça dépend des applications, on peut changer le nombre de workers qu’on démarre.</p>
<p>On va attendre un nombre de workers qui vont attendre.</p>
<p>Ça, sur nos applications Symfony, ça permet d’accélérer nos performances.</p>
<p>Il y a la même chose qui est disponible pour Laravel Octane. Ils supportent aussi d’autres outils comme RoadRunner et Soul. Il y a quelques autres outils, comme CMS, qui supportent nativement ce mode worker. Malheureusement, ça ne marche pas pour l’instant avec Drupal, il y a des problèmes de session.</p>
<p>Je suis disponible cet après-midi pour regarder s’il y a une solution pour régler ça.</p>
<p>La coreteam de Laravel a fait pas mal de tests. Ils nous ont bien rendu service. Ils ont tellement manipulé l’outil, ils ont envoyé un nombre de bugs énorme. Honnêtement, c’était plutôt pratique. L’équipe a fait des benchmarks sur leur outil, et là-dessus, ils arrivent à des résultats assez impressionnants. FrankenPHP est cinq fois plus rapide que Soul, et deux fois plus rapide que RoadRunner.</p>
<p>En termes de performance web, ça fait une différence énorme, quand on compare à du PHP sans mode worker.</p>
<p>Ceci dit, toutes les applications ne sont pas hyper bien faites. Il y a des bidouilles possibles. Les deux proposent une option de configuration pour redémarrer le script.</p>
<p>Il y a quand même quelques trucs qui permettent de l’utiliser assez facilement pour des applications qui n’ont pas été conçues pour.</p>
<p>Autre fonctionnalité, qui elle marche avec Drupal, qui est spécifique à FrankenPHP. Le support 103. Qui en a déjà entendu parler ?  Quand même pas mal de monde.</p>
<p>J’espère que les autres, vous allez tester ça dès que vous allez être sur vos projets clients. Il y a quelques années, il y a eu une FRC expérimentale pour améliorer la performance des sites web.</p>
<p>Ce truc n’a pas été implémenté pendant longtemps, car il y avait une alternative plus efficace. A un moment, Google a dit qu’il fallait supprimer ça.</p>
<p>Ce n’est donc plus supporté par Google Chrome.</p>
<p>Ça répondait quand même à un vrai cas d’usage. Du coup, ils l’ont ressorti.</p>
<p>Et c’est aussi supporté par Firefox depuis pas très longtemps.</p>
<p>C’est beaucoup plus simple à implémenter et à comprendre, et à coder.</p>
<p>Ce truc, depuis cet été, c’est supporté par tous les navigateurs, ça permet d’améliorer beaucoup les performances des applications web, en particulier celles qui ont beaucoup d’assets, beaucoup d’images etc.</p>
<p>Il y a eu des études menées par Shopify, Google, etc., qui donnent des résultats assez impressionnants :  plus de 500 millisecondes de gain.</p>
<p>Comment ça marche ? </p>
<p>Une page web traditionnelle a un fonctionnement synchrone :  d’abord, on a une requête. Le navigateur va demander une ressource. Il faut que le serveur génère ce fichier html, au moins les entêtes.</p>
<p>Ça va prendre pas mal de temps.</p>
<p>Après, vous allez connaître la taille de votre body, et vous allez commencer à streamer.</p>
<p>Pour afficher les données à l’utilisateur, en plus, il faut un fichier CSS, et en plus des images, donc du Javascript en plus.</p>
<p>Seulement à ce moment-là, le navigateur va commencer à télécharger ces éléments, et il pourra faire le calcul, le rendu pour afficher la page à l’utilisateur.</p>
<p>Le principe du Early Hints, c’est que vous savez à l’avance qu’il y aura besoin de ça. C’est dommage d’attendre de faire toutes les requêtes SQL etc.    pour seulement commencer à télécharger ces éléments qui seront de toute façon    nécessaires.</p>
<p>En face d’une requête, on peut envoyer plusieurs réponses. Ce n’est pas très connu.</p>
<p>Quand votre navigateur demande un upload de fichier, il demande la taille du fichier, et le serveur dit :  je ne l’accepte pas ! </p>
<p>Donc ils ont ajouté le code. Tout de suite, on peut envoyer une réponse informative avec des entêtes http link.</p>
<p>Ensuite, serveur think time, c’est notre PHP, notre code bien propre, qui va prendre un peu de temps. Pendant ce temps-là, le navigateur télécharge les assets.</p>
<p>Ça permet de faire gagner beaucoup de temps. Ça n’accélère pas les réponses http. Par contre, ça accélère la latence perçue, car on va pouvoir paralléliser au maximum.</p>
<p>C’est clair ce que je raconte ?  OK.</p>
<p>N’hésitez pas à me dire.</p>
<p>Côté serveur, ça a pris plus de temps. Ce n’était pas si évident que ça. En PHP, en 2021,    on a vu la pool and *.</p>
<p>Petite contrainte :  ils n’ont activé ça que pour https.</p>
<p>En PHP, en général, on utilise PHP FPM. Du coup, la connexion http 2 et 3, c’est fait avec le serveur web.</p>
<p>Déjà, une requête, une réponse. Ça pose un premier souci.</p>
<p>Deuxième problème :  de toute façon, il faut avoir accès à la connexion DCP pour faire ça. En PHP, on ne l’a pas, donc c’est mort.</p>
<p>En Go, théoriquement, c’était possible. Mais Google n’avait pas fait les patches pour le faire. On a bossé avec l’équipe de Go, pour des raisons qui n’avaient rien à voir avec FrankenPHP,    j’avais contribué, le support des Early Hints, on avait ajouté le support de ça à Go. On s’est dit :  il y a le support de ça dans Go. Et nous, le serveur web et l’exécuteur PHP, c’est le même process :  on a accès à la connexion UDP. Donc on pourrait gérer les Early Hints.</p>
<p>On a regardé avec quelques collègues comment c’était possible de le faire, ce serait extrêmement compliqué.</p>
<p>En Go, c’est supporté. Donc c’était assez facile d’ajouter le support de ça dans FrankenPHP.</p>
<p>On a repris la RFC de Nikita, on a implémenté des fonctions qui sont disponibles pour l’instant que dans FrankenPHP mais qui, à terme, pourraient un jour être ajoutées dans d’autres Sapi.</p>
<p>On utilise la fonction header. Ensuite, une nouvelle fonction, ajoutée par FrankenPHP, c’est header send qui prend en compte un paramètre de statut. Et on déclenche immédiatement une réponse 103.</p>
<p>Depuis Symfony 7, je crois, c’est aussi disponible de base dans Symfony http Foundation.</p>
<p>Vous pouvez récupérer votre réponse Symfony, modifier l’entête.</p>
<p>Vous pouvez le faire dès aujourd’hui dans vos applications.</p>
<p>On a aussi un autre problème traditionnel dans PHP qui est le temps réel. PHP, temps d’exécution, maximum, 30 secondes. Donc pas trop possible.</p>
<p>Des gens ont déjà utilisé Mercure ?  Merci à vous, c’est cool.</p>
<p>L’idée est de pouvoir laisser le serveur envoyer des données en temps réel.</p>
<p>En fait, ce truc est aussi écrit en Go, et aussi disponible sous forme de bibliothèque autonome. On l’a intégré de base dans FrankenPHP.</p>
<p>Depuis votre script PHP, il n’y a qu’à faire une requête http vers le serveur lui-même.</p>
<p>C’est aussi supporté de base par Symfony. Du coup, vous pouvez utiliser la hub interface. Vous créez votre update, vous appelez la méthode Publish, et le navigateur va recevoir la donnée.</p>
<p>Côté navigateur, on n’a juste à utiliser Event Source pour s’abonner.</p>
<p>Dernière feature :  la possibilité de packager vos applications sous forme de Binaire. Vous allez pouvoir le lancer sans aucune autre dépendance. Pour distribuer des applications, si vous les vendez à plusieurs clients, pour un ERP, c’est une manière de distribuer sans avoir besoin d’installer PHP.</p>
<p>Vous pouvez empaqueter votre application Drupal dedans.</p>
<p>Il faut que ce soit en mode prod. Vous clonez le dépôt. Il y a un script à exécuter.</p>
<p>Ensuite, ça crée un binaire, quand vous lancez le binaire, votre application Drupal est exposée, vous pouvez lancer des commandes.</p>
<p>Merci à tous.</p>
<p>J’espère que ça vous a donné envie d’essayer.</p>
<p>S’il y a des gens qui sont motivés à faire marcher le mode worker avec Drupal, ce qui n’est pas le cas actuellement, on peut essayer de le faire.</p>
<p>- On est un peu à la bourre, mais est-ce qu’il y a des questions ? </p>
<p>- Merci pour la présentation.</p>
<p>Ça fait du sens d’avoir Drupal qui propose FrankenPHP par défaut dans le corps pour tout ce qui est serveur d’application  ? </p>
<p>- Kévin Dunglas  :  Je ne connais pas bien comment c’est distribué, Drupal. En tout cas, dans Symfony et API plateforme, c’est ce qu’on met par défaut maintenant. Et Laravel, pour l’instant, le support est encore expérimental, mais normalement, c’est ce qui sera par défaut. En tout cas, nous, ça nous ferait plaisir, clairement.</p>
<p>- Bonjour. Merci.</p>
<p>Quand tu utilises FPM, tu peux lancer un certain nombre de processus en attente de requêtes. Sur la stabilité de la solution, comment tu présentes les choses ? </p>
<p>- Kévin Dunglas  :  Il y a la partie écrite en Go et la partie écrite en C, qui cohabitent dans le même process.</p>
<p>Go    est fait pour ça. Le système de Goroutines, tout est géré automatiquement. Il y a quelques variables d’environnement qui permettent de configurer le moteur.</p>
<p>Globalement, si c’est un serveur classique, il vaut mieux laisser le truc par défaut.</p>
<p>Puis, la partie en C, par défaut, on lance deux par CPU. C’est configurable. C’est bien de regarder en fonction de votre application quelle est la meilleure valeur, et d’augmenter ou de diminuer le nombre de workers pour utiliser 100% du CPU.</p>
<p>Dans le futur, là, on bosse pas mal avec les gens de la fondation PHP    pour voir à simplifier quelques trucs pour ne plus utiliser de vrais threads.</p>
<p>Il y a quand même pas mal de boulot à faire dans le coeur de PHP pour ça. Du coup, on ne sait pas si ça arrivera un jour, ni quand. Mais il y a encore des marges d’optimisation possibles.</p>
<p>- Merci.</p>
<p>- Bonjour. Un des soucis qu’on a dans Drupal, avec les applications qui durent longtemps, en production, c’est les changements de topologies qui provoquent des ruptures de connexion vers la base de données par exemple.</p>
<p>Pourrait-on le remonter vers PHP par exemple ? </p>
<p>- Kévin Dunglas: c’est un problème qui est récurrent.</p>
<p>Il commence à y avoir du code, si la connexion a été coupée, qui la relance aussitôt. Du pooling, ça dépend des drivers, de la base de données    que vous utilisez, mais il y en a qui supportent du pooling.</p>
<p>Cela n’empêche pas que, s’il y a un time out, il y aura quand même un problème.</p>
<p>Du coup, je ne suis pas sûr qu’il y ait un gros intérêt à gérer ça en Go.</p>
<p>Ceci dit, techniquement, l’un des avantages de la solution, pour ceux qui savent coder bas niveau, on peut utiliser n’importe quelle bibliothèque Go, et les exposer dans PHP via une fonction. Ce n’est pas fait pour l’instant. Je ne suis pas sûr que ce soit la meilleure approche.</p>
<p>Mais techniquement, ce serait possible, oui.</p>
<p>- D’autres questions ? </p>
<p>- Une question sur l’environnement plus que la technique. Depuis combien de temps ça a commencé FrankenPHP? Il y a un business model derrière ? </p>
<p>Sur le long terme, si on veut utiliser ça dans Drupal, on a besoin que ce soit solide pendant au moins dix ans.</p>
<p>- Kévin Dunglas  :  Bonne question.</p>
<p>A la base, c’était un truc pour s’amuser, et un sujet de conférence pour essayer de faire marcher le moteur d’exécution PHP en Go. Il s’est avéré que ça marchait mieux que prévu, donc on a poussé le truc.</p>
<p>Maintenant, ça commence à être utilisé beaucoup en production, à être intégré dans les gros frameworks.</p>
<p>Il n’y a pas de business model derrière, c’est un projet libre, dont les contributeurs sont aussi des core contributeurs.</p>
<p>Il n’y a pas vocation à faire du business avec l’outil. Ce qu’on fait chez Les Tilleuls, c’est qu’on considère qu’on fait du bon boulot, et les gens nous appellent  quand ils ont besoin, ça finance le truc.</p>
<p>Le projet est sponsorisé par Les Tilleuls et maintenu par Caddy lui-même.</p>
<p>Ça leur donne une visibilité très forte au sein de Laravel. Caddy a été créé par des gens dont une personne était développeur chez Laravel.</p>
<p>Ils veulent se développer là-dessus, et eux, ils ont un business model autour de Caddy. On peut acheter la prestation, et surtout du support.</p>
<p>Pour toute la partie Go, module Caddy, la maintenance    est faite en collaboration    avec Caddy, la communauté.</p>
<p>- On va arrêter les questions. Il ne reste qu’un quart d’heure pour le café.</p>
<p>Comme vous voulez.</p>
<p>Ça redémarre à 11h.</p>

        </div>
        
      </div>
      
    </div>
  </div>
</main>


      <footer class="site-extra">
  <div class="site-extra__wrapper">
    <div class="site-extra__newsletter">
      <p class="site-extra__newsletter-text">Ne manquez pas la prochaine actu !</p>
      <a href="/newsletter" class="site-extra__newsletter-link">S'inscrire à la newsletter</a>
    </div>

    
    
    
    

    
      <div class="site-extra__sponsors collection-readmore--titled">
        <header class="collection-readmore__header">
          <h2 class="collection-readmore__title">Merci à nos principaux sponsors</h2>
          <a href="/sponsors" class="collection-readmore__readmore-link" title="Explorer la liste complète de nos sponsors">Voir tous nos sponsors</a>
        </header>
        <div class="site-extra__sponsors-collection collection-readmore__items">
          
            
            
            
            <ul class="site-extra__sponsors-type-items site-extra__sponsors-type-items--01_gold">
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/talan-solution/" class="sponsor-logo" title="Visiter le site du sponsor Talan Solutions">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Talan Solutions" loading="lazy"
       src="/sponsors/talan-solution/logo/talan_couleur_huf50e55e89bbdefaddf420843d7cbb0b9_31064_180x0_resize_box_3.png" width="180" height="121" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/smile/" class="sponsor-logo" title="Visiter le site du sponsor Smile">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Smile" loading="lazy"
       src="/sponsors/smile/logo/smile-eu-logo-vector_hu40c09b5e73aaadc6796ff69275dd8971_18926_180x0_resize_box_3.png" width="180" height="180" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/open/" class="sponsor-logo" title="Visiter le site du sponsor Open">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Open" loading="lazy"
       src="/sponsors/open/logo/open_logotype_signature_horiz_exe_positif_rvb_hu521fb7ccabcb1ccb0147bb00633de262_43796_180x0_resize_box_3.png" width="180" height="54" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/axess/" class="sponsor-logo" title="Visiter le site du sponsor Axess">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Axess" loading="lazy"
       src="/sponsors/axess/logo/logo-axess-2021-1_hu6c9454bf8ac227c8cfe468493aa3f663_24370_180x0_resize_box_3.png" width="180" height="48" />


  </div>
</a>
</li>
              
            </ul>
          
          
            
            
            
            <ul class="site-extra__sponsors-type-items site-extra__sponsors-type-items--02_silver">
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/koriolis/" class="sponsor-logo" title="Visiter le site du sponsor Koriolis">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Koriolis" loading="lazy"
       src="/sponsors/koriolis/logo/logo-koriolis-2023_hu5e4d2e40443d53cd46797d758ab6dd0b_133466_70x0_resize_box_3.png" width="70" height="41" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/conserto/" class="sponsor-logo" title="Visiter le site du sponsor Conserto">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Conserto" loading="lazy"
       src="/sponsors/conserto/logo/logo-conserto-rond_hu7de0c03beb244ce40f7d5d3ee47b955b_112569_0x70_resize_box_3.png" width="61" height="70" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/ecedi/" class="sponsor-logo" title="Visiter le site du sponsor ecedi">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="ecedi" loading="lazy"
       src="/sponsors/ecedi/logo/ecedi_togael_cmjn_ecedi_baseline_cmjn_hu8cd43662bbf93b8515b19df83816c66d_11565_70x0_resize_box_3.png" width="70" height="24" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/capgemini/" class="sponsor-logo" title="Visiter le site du sponsor Capgemini">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Capgemini" loading="lazy"
       src="/sponsors/capgemini/logo/logo-capgemini_hu9940b5194e315ad3699f4181534a992c_3847_70x0_resize_box_3.png" width="70" height="16" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/bluedrop/" class="sponsor-logo" title="Visiter le site du sponsor bluedrop.fr">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="bluedrop.fr" loading="lazy"
       src="/sponsors/bluedrop/logo/logo-bluedrop-vertical-2-_hu7746c17d82190d8c4ef9c4e28df8b4fe_12162_70x0_resize_box_3.png" width="70" height="53" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/makina-corpus/" class="sponsor-logo" title="Visiter le site du sponsor Makina Corpus">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Makina Corpus" loading="lazy"
       src="/sponsors/makina-corpus/logo/mc_logo_vertical_quadri_hu46525694772d97ad2fdd68cf6074b279_110553_0x70_resize_q75_box.jpg" width="67" height="70" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/luminess/" class="sponsor-logo" title="Visiter le site du sponsor Luminess">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Luminess" loading="lazy"
       src="/sponsors/luminess/logo/logo-noir-baseline_hue61e094dc2c81b18620c3729d2f2f7d3_46601_70x0_resize_box_3.png" width="70" height="22" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/acquia/" class="sponsor-logo" title="Visiter le site du sponsor Acquia">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="Acquia" loading="lazy"
       src="/sponsors/acquia/logo/logo_acquia_hu5cb157a66a67e62551113142e4581b84_7758_70x0_resize_box_3.png" width="70" height="15" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/iosan/" class="sponsor-logo" title="Visiter le site du sponsor IOSAN">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="IOSAN" loading="lazy"
       src="/sponsors/iosan/logo/iosan-logo-couleurs-rvb_hucd0aae511f652fd6ad049ea07f4a1da1_78034_70x0_resize_box_3.png" width="70" height="30" />


  </div>
</a>
</li>
              
              
              <li class="site-extra__sponsors-type-item"><a href="/sponsors/almavia-cx/" class="sponsor-logo" title="Visiter le site du sponsor ALMAVIA CX">
  <div class="sponsor-logo__image-frame">
    


  






  
  
    
  
  
  <img class="sponsor-logo__image" alt="ALMAVIA CX" loading="lazy"
       src="/sponsors/almavia-cx/logo/almaviacx-logo_bleu_hu4800cdecaeba5fa97035d2f6b176b59d_106099_70x0_resize_box_3.png" width="70" height="37" />


  </div>
</a>
</li>
              
            </ul>
          
          
        </div>
      </div>
    

    <div class="site-extra__links_collection">
      <div class="site-extra__column">
        <h3 class="site-extra__column-title">Drupalcamp Rennes 2024</h3>
        <ul class="site-extra__column-content">
          <li class="site-extra__column-item"><a href="/billetterie">Billetterie</a></li>
          <li class="site-extra__column-item"><a href="/sponsors">Sponsors</a></li>
          
          
            
              <li class="site-extra__column-item"><a href="/programme/appel">Appel à conférences</a></li>
            
          

          
          
            
              <li class="site-extra__column-item"><a href="/infos/accès">Accès</a></li>
            
          

          
          
          <li class="site-extra__column-item"><a href="/mentions-légales">Mentions légales & confidentialité</a></li>
        </ul>
      </div>

      <div class="site-extra__column">
        <h3 class="site-extra__column-title">Restons en contact</h3>
        <ul class="site-extra__column-content">
          <li class="site-extra__column-item"><a href="/contact">Nous contacter</a></li>
          <li class="site-extra__column-item"><a href="/newsletter">Newsletter</a></li>
          <li class="site-extra__column-item"><a href="/actualites">Dernières informations</a></li>
        </ul>
        <h3 class="site-extra__column-title">Suivre l'association</h3>
        <ul class="site-extra__column-content">
          <li class="site-extra__column-item"><a href="https://drupal.fr" title="Accéder au site externe de l'association Drupal FR">Site officiel Drupal FR</a></li>
        </ul>
      </div>

      <div class="site-extra__column">
        <h3 class="site-extra__column-title">Dialoguer avec la communauté</h3>
        <img src="/img/logo_dfr.svg" alt="Logo Drupal France" loading="lazy" />
        <ul class="site-extra__column-content site-extra__column-content--social">
          <li class="site-extra__column-content-link"><a href="https://drupalfrance.slack.com" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur Slack</title>
    <use xlink:href="/icons/social.svg#sprite-icons-slack" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://drupal.community/@drupalfr" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur Mastodon</title>
    <use xlink:href="/icons/social.svg#sprite-icons-mastodon" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://www.linkedin.com/company/drupal-france-&amp;-francophonie/" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur LinkedIn</title>
    <use xlink:href="/icons/social.svg#sprite-icons-linkedin" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://twitter.com/drupalcampfr" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur X</title>
    <use xlink:href="/icons/social.svg#sprite-icons-twitter" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://www.youtube.com/channel/UCIa6rzX4xvIu6eas8MZMCAw" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur YouTube</title>
    <use xlink:href="/icons/social.svg#sprite-icons-youtube" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://www.facebook.com/groups/49522240874/" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur Facebook</title>
    <use xlink:href="/icons/social.svg#sprite-icons-facebook" />
  </svg>
</a>
</li>
          <li class="site-extra__column-content-link"><a href="https://www.instagram.com/drupalfrance/" class="link" title="">
  <svg class="icon icon--social">
    <title>Drupal FR sur Instagram</title>
    <use xlink:href="/icons/social.svg#sprite-icons-instagram" />
  </svg>
</a>
</li>
        </ul>
      </div>
    </div>
  </div>
  <p class="images-credits">
    Yuna, notre mascotte a été imaginée et mise en valeur par Adrien et Aliénor.<br />
    Icônes Noun Project CC BY 3.0 : (Infos - Putri Afifah Octaviani / Externe - Astri Widiastari Ritonga / Menu - Damian Hetman / Croix - andriwidodo)<br />
    Icônes Iconfinder CC BY 4.0 : (Tags - Icons8 Com)
  </p>
</footer>

      
      
      <script src="/js/camp.js"></script>
      
    </div>
  </body>
</html>
